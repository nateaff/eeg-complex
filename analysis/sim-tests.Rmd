---
title: "Simulation Examples"
author: "Nathanael Aff"
date: 2017-05-10
output: 
  html_document: 
    code_folding: hide
---

<!-- The file analysis/chunks.R contains chunks that define default settings
shared across the workflowr files. -->

```{r read-chunk, include=FALSE, cache=FALSE}
knitr::read_chunk("../analysis/chunks.R")

```

<!-- Update knitr chunk options -->
```{r knitr-opts-chunk, include=FALSE}

```

<!-- Insert the date the file was last updated -->
```{r last-updated, echo=FALSE, results='asis'}

```

<!-- Insert the code version (Git commit SHA1) if Git repository exists and R
 package git2r is installed -->
```{r code-version, echo=FALSE, results='asis'}

```

The $\varepsilon-$complexity coefficients are computed by sucessively downsampling and approximating or interpolating the original function. The initial implementation of the $\varepsilon-$complexity computation used piecewise polynomials as the approximation method. For our `R` implementation we used three approximation methods, B-splines, cubic splines and interpolating subdivision. The latter method coded in `R` 
while existing libraries were used for the two spline methods. 


```{r sim-load}
knitr::read_chunk("../code/sim-example.R")
```


```{r sim-create, fig.cap = "Single time series from each simulation group."}
<<sim-example-create>>
```

In theory developed by Piryatinska and Darkhovsky[^1], the $log-log$ regression of approximation errors taken at each downsampling level $S$ should be roughly linear. The implementation of the three approximation methods were checked to determine that the relationship held. Below is the plot for the interpolating subdivision method.


```{r sim-plot, fig.cap = "Diagnostic plots for interpolating subdivision."}
<<sim-example-plot>>
```


```{r sim-features0}
knitr::read_chunk("../code/ecomplex-plot-feature-space.R")

```
```{r sim-features1}
devtools::load_all()
<<sim-feature-space>>
```

## Approximation method performance

The purpose of adding addtional approximation methods was to improve the performance of the complexity coefficients in classification and segmentation tests. We hypothesized that lowering approximation error would improve the performance of the complexity coefficients in classification and segmentation tasks.  

For the following test the two groups consisted of 30 simulations generated by randomly perturbing the parameters of each process of function within a small window about its initial parameters. A plot of the simulations in the feature space of the two complexity coefficients shows that the complexity coefficient generated by each method lie in roughly the same area in the coefficient space.

```{r sim-features, fig.cap = "Simulations plotted in the features space of the complexity coefficients A and B."}
<<ecomplex-feature-space>>
```

The B-spline produced the lowest approximation error for all methods but did not out perform the other methods in the classification task. 


```{r approx-errors}
  devtools::load_all()
  prefix = "ecomplex"

  err_means <- readRDS(cache_file("all_errs", prefix))
  rf_errs <- readRDS(cache_file("rf_errs", prefix))
  
  err_means <- data.frame(err_means)
  names(err_means) <- names(rf_errs)
  row.names(err_means) <- row.names(rf_errs)
  knitr::kable(err_means, caption = 'Approximation error for each method.')

```

```{r class-errors}
  knitr::kable(rf_errs, caption = 'Classification error for each method.')
````

The complexity coefficients were used as features in a random forest classifier, the same classifier we used in later applications. No approximation method was clearly dominant but the methods with higher approximation errors performed as well or better than the B-spline method. While all three approximation methods are similar -- essentially, they all use lower order polynomial approximation -- the results do indicate improved approximation doesn't lead to improved performance in classification. 

For later applications, the cubic splines method was used because of the computational efficiency of the implementation. 





[^1]: [Epsilon-complexity of continuous functions](https://arxiv.org/abs/1303.1777)

## Session information

<!-- Insert the session information into the document -->
```{r session-info}

```
